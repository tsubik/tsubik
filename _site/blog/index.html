<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Open-minded software developer who loves creating useful web apps (C#, asp.net mvc, jQuery, javascript, ruby on rails)">
    <title>Blog | Tomasz Subik software developer</title>
    <link href="/css/reset.css" rel="stylesheet" type="text/css" />
    <link href="/css/Site.css" rel="stylesheet" type="text/css" />
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- [if lt IE 9]>
        <script src="scripts/css3-mediaqueries.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="/img/favicon.ico" />
</head>
<body>
    <div id="container">
        <header>
        <section id="sectionMyName">
        <a href="/" class="nounderline">
            <h2>Tomasz Subik</h2>
            <span id="myTitle">software developer</span>
        </a>
        </section>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/blog/">Blog</a></li>
                <li><a href="/projects.html">Projects</a></li>
            </ul>
        </nav>
        </header>
        <div style="clear: both;">
        <div>
    
         <section class="blog-posts">
            <article>
                <header class="post-header">
                   <a href="/blog/generate-migrations-for-db-projects-automate-visual-studio-with-powershell/">
                    <h1 class="post-title">
                        Generate migrations for DB projects - automate Visual Studio with powershell
                    </h1>
                    </a>
                    <p>
                        <time datetime="2014-06-14 00:00:00 +0200">14 June, 2014</time>
                    </p>
                </header>
                <div class="post-content">
                     <p>Recently I was working on providing database migrations solution for a quite large .NET learning management system. It was a shame that there was nothing to automate process of updating production databases and everything must have been done manually. We are using custom ORM solution, VS Database project to keep database schemas in source control and factories to populate databases with static and some test data. Schemas are large - contain hundreds of tables, views and thousand of stored procedures which is why when I was looking for database migrations solution a good maintaining of updating changes in procedures was a must. </p>



<h2 id="solution">Solution</h2>

<p>I managed to find only one which satisfied these needs - <a href="https://github.com/chucknorris/roundhouse">roundhouse</a>. Unfortunately, there were some problems in applying roundhouse to this project but maybe a detailed migration process is a topic for another post. There were, in short, some changes to be made in rh library and I didn’t like its way of creating database which was “get initial schema and run all migrations”. I preferred to create a “fresh” database directly from schema which would support database project and that’s why I am using both roundhouse (to apply migrations and changes in views/stored procs/functions - and in general keeping database in specific version) and database project (to keep schema in source control and creating database from schema). </p>

<p>Process of development requires creating differential scripts besides applying changes in database project. Diff scripts do not need to store changes in stored procedures/views/functions because roundhouse ensures that. So, a developer can now update database project directly using designers  in visual studio and save generated diff update script as a new migration. To apply changes to databases he needs to use roundhouse. But manually creating a script with specific name every few minutes is boring and it is therefore first on the list to automate this process.</p>

<p>What we need is to perform a few simple steps.</p>

<ol>
  <li>Change schema in database project.</li>
  <li>Compare database project with database on the developer server. Using schema compare tool we can ignore specific object types e.g. stored procedures/views/functions and save comparison as comparison profile in scmp file.</li>
  <li>Generate script with changes and save it to migration folder with specific name eg. with format like YYYYMMddhhmmss_MIGRATION_NAME.sql  </li>
</ol>

<p>Unfortunately, there is no way, or I cannot find one, to compare database project with database using a command line tool where I could provide a list of types of objects to ignore. That’s why I create powershell script running commands inside Visual Studio.</p>

<script src="https://gist.github.com/tsubik/34d2d80e90a924fc718c.js"></script>

<p>To create migration you must have solution with database project opened.
Running script will add migration file to your solution (do not mess around in editor while script is running).</p>

<p><img src="/images/blog/migration_file.jpg" alt="Migration file added to solution" /></p>

<p>Examples:</p>

<p><code>
PM&gt; .\AddMigration.ps1 –n MigrationName 
</code></p>

<p>For other database project in solution</p>

<p><code>
PM&gt; .\AddMigration.ps1 –n MigrationName –p NotDefaultDatabaseProject 
</code></p>

<p>To generate only empty file for migration</p>

<p><code>
PM&gt; .\AddMigrations.ps1 –n MigrationName –of
</code></p>

<p>This solution is not ideal mainly because is too slow, but it is working and is better than manually doing this.</p>

                </div>
            </article>
        </section>
        <hr class="blog-posts-separator"/>
   
         <section class="blog-posts">
            <article>
                <header class="post-header">
                   <a href="/blog/sass-with-aspnet-mvc4-twitter-bootstrap-example/">
                    <h1 class="post-title">
                        Sass with ASP.NET MVC 4 - Twitter Bootstrap example
                    </h1>
                    </a>
                    <p>
                        <time datetime="2013-01-05 00:00:00 +0100">05 January, 2013</time>
                    </p>
                </header>
                <div class="post-content">
                     <p>Many times if I look at css stylesheets of middle and big systems it just makes me cry. Total chaos, code repetition, basically too much css. That’s why css preprocessors were invented. In the .NET world the most popular right now is Less. However, for a long time there is another player on the market - <a href="http://sass-lang.com">Sass</a>. And that is what this post will be about - Sass along with asp.net (no matter mvc or not). If anyone doesn’t know what Sass is, <a href="http://sass-lang.com">check it out</a>. In a nutshell it is CSS preprocessor giving you much more power to create your stylesheets (nesting, mixing, variables, etc.). Blablabla… anyway in many comparisons to less, sass is the winner, but you will choose whichever you like more.
There are some posts over the Internet describing how to use Sass with asp.net, but I want to show you how I’m using it and what I am avoiding.</p>

<h2 id="pre-requirements">Pre-requirements</h2>

<p>Simple list what do we need to start playing around Sass:</p>

<ul>
  <li>Sass preprocessor engine</li>
  <li>VS syntax highlight</li>
  <li>something for debugging in the browser</li>
</ul>

<p>What I am using:</p>

<ul>
  <li><a href="http://compass-style.org">Compass</a> which using Sass as a preprocessor. You need to <a href="http://rubyinstaller.org/">install ruby</a> envoirement and then simple using your favorite console shell
<code>gem install compass</code></li>
  <li>For syntax highlighting I am using <a href="http://visualstudiogallery.msdn.microsoft.com/07d54d12-7133-4e15-becb-6f451ea3bea6">Web Essentials</a> - I highly recommend this extension. Sass support is a new feature there and soon will be much better.</li>
  <li>For development, debugging - Chrome development tools (for firefox users - <a href="https://addons.mozilla.org/pl/firefox/addon/firesass-for-firebug">FireSass</a>)</li>
</ul>

<p>Ok. So what I am avoiding:</p>

<ul>
  <li>Mindscape Web Workbench. Why??
    <ul>
      <li>It’s too heavy</li>
      <li>“Go Pro” everywhere. I’m sick of it. Want to comment a line in your .scss file using VS’s shortcut - “commenting is only in pro version” - WTF? Are you kidding me?</li>
      <li>It using compass so.. do not rely on some commercial tools, when it is soo simple to use what they are using. </li>
    </ul>
  </li>
  <li>That’s it</li>
</ul>

<p>I recommend installing stuff I am using, but if you do not want install ruby and compass manually and you are “console hater” you can start with Web Workbench (it is using compass so ruby will be installed anyway).</p>

<h2 id="lets-rock---basic-app">Let’s rock - basic app</h2>

<p>You have everything set up, so let’s play.
We don’t want to build solution from scratch that’s why we will use twitter bootstrap nuget package.</p>

<p>First steps.</p>

<ol>
  <li>Create new empty MVC 4 project.</li>
  <li>Install packages.</li>
</ol>

<noscript><pre>
	PM&gt; Install-Package twitter.bootstrap.mvc4
	PM&gt; Install-Package twitter.bootstrap.mvc4.sample
</pre></noscript>
<script src="https://gist.github.com/4457378.js?file=install_packages"> </script>

<p>That’s it. Fire up application and see what we got so far.</p>

<p><img src="/images/blog/twitter_sass1.png" alt="ASP.NET MVC 4 with Twitter Bootstrap and Sass" title="ASP.NET MVC 4 with Twitter Bootstrap and Sass" /></p>

<p>Now our application is using standard css stylesheets. Our goal is to replace them with a Sass files.</p>

<h2 id="sass-goodness">Sass goodness</h2>

<p>I found out a nice <a href="https://github.com/jlong/sass-twitter-bootstrap">port from Less to Sass bootstrap</a>. Nice job guys! Sure we gonna use it.</p>

<p>If you have git, simple clone the repo, if you don’t… <a href="http://msysgit.github.com">install git</a> :]. Fine, if you don’t, just download zipped repo.</p>

<p>Next steps.</p>

<ol>
  <li>Delete all css files in Content folder.</li>
  <li>Create Content\Sass\Twitter directory and copy there all files from lib directory of cloned sass twitter port.</li>
  <li>
    <p>Initialize compass project. Open console in root folder of web application.
<code>
 compass init
</code>
That will set up default compass project configuration. We need to change it a little bit.
So now:</p>
  </li>
  <li>Delete sass and stylesheet folder created in root path.</li>
  <li>Edit config.rb file
    <noscript><pre>
     # Set this to the root of your project when deployed:
     http_path = "/"
     css_dir = "Content"
     sass_dir = "Content/sass"
     images_dir = "Content/images"
     javascripts_dir = "javascripts"
 </pre></noscript>
    <script src="https://gist.github.com/4457378.js?file=config.rb"> </script>
  </li>
  <li>Add application.scss file to Content/sass directory
    <noscript><pre>
     @import "compass/reset";
     @import "twitter/bootstrap";
     @import "twitter/responsive";
 </pre></noscript>
    <script src="https://gist.github.com/4457378.js?file=application_v1.scss"> </script>
  </li>
</ol>

<p>So we are using one of compass built-in stylesheet (reset), main twitter bootstrap and reponsive stylesheet.</p>

<p>Let’s compile ours stylesheets
<code>compass compile</code>
Now in Content directory we have all needed stylesheets.</p>

<p>Update application layouts to use application.css from Content directory.</p>

<p>delete followings</p>
<noscript><pre>
&lt;![CDATA[
	&lt;link href="@Styles.Url("~/content/css")" rel="stylesheet"/&gt;
	&lt;link href="@Styles.Url("~/Content/css-responsive")" rel="stylesheet" type="text/css" /&gt;
]]&gt;
</pre></noscript>
<script src="https://gist.github.com/4457378.js?file=layout_1.html"> </script>

<p>add only application.css</p>
<noscript><pre>
&lt;![CDATA[
	&lt;link href="@Styles.Url("~/Content/application.css")" rel="stylesheet" type="text/css" /&gt;
]]&gt;
</pre></noscript>
<script src="https://gist.github.com/4457378.js?file=layout_2.html"> </script>

<p>Run application to check out if everything is working as it should.</p>

<h2 id="playground">Playground</h2>

<p>Before you start doing anything using Sass I recommend get familiar with its features - <a href="http://sass-lang.com/tutorial.html">Sass tutorial</a>. After that we can play around.</p>

<p>I changed “sing-up” page.</p>

<p>Move inline style from _BootstrapLayout.empty.cshtml layout into application.scss</p>

<noscript><pre>
body {
	padding-top: 40px;
	padding-bottom: 40px;
	background-color: #f5f5f5;
}
.form-signin {
	max-width: 300px;
	padding: 19px 29px 29px;
	margin: 0 auto 20px;
	background-color: #fff;
	border: 1px solid #e5e5e5;
	-webkit-border-radius: 5px;
	   -moz-border-radius: 5px;
	        border-radius: 5px;
	-webkit-box-shadow: 0 1px 2px rgba(0,0,0,.05);
	   -moz-box-shadow: 0 1px 2px rgba(0,0,0,.05);
	        box-shadow: 0 1px 2px rgba(0,0,0,.05);
}
.form-signin .form-signin-heading,
.form-signin .checkbox {
	margin-bottom: 10px;
}
.form-signin input[type="text"],
.form-signin input[type="password"] {
	font-size: 16px;
	height: auto;
	margin-bottom: 15px;
	padding: 7px 9px;
}
</pre></noscript>
<script src="https://gist.github.com/4457378.js?file=application.css"> </script>

<p>Now change it a little bit using sass features (I’m using variables from twitter bootstrap here) and import twitter bootstrap and compass default reset stylesheet.</p>
<noscript><pre>
@import "compass/reset";
@import "twitter/bootstrap";
body
{
    padding-top: 40px;
    padding-bottom: 40px;
    background-color: $white;
}
.form-signin
{
    max-width: 300px;
    padding: 19px 29px 29px;
    margin: 0 auto 20px;
    background-color: $formActionsBackground;
    border: 1px solid $inputBorder;
    @include border-radius($baseBorderRadius);
    @include box-shadow(inset 0 1px 2px rgba(0,0,0,.05));
    .form-signin-heading, .checkbox
    {
        margin-bottom: 10px;
    }
    input[type="text"], input[type="password"]
    {
        font-size: 16px;
        height: auto;
        margin-bottom: 15px;
        padding: 7px 9px;
    }
}   
@import "twitter/responsive";
</pre></noscript>
<script src="https://gist.github.com/4457378.js?file=application_v2.scss"> </script>

<p>It will change a little design, but… so what. In this little example I show you usage of variables, mixins and nestings. </p>

<p>I don’t want to create sass tutorial here, just do what you want, experiment.</p>

<h2 id="debugging-sass">Debugging sass</h2>

<p>There is something that everyone hates in every code generating languages like coffeescript, typescript, less and sass - troubles with debugging. Browser shows you some errors in specific line of code which have nothing to do with your original development files.</p>

<p>You can find some solutions to this problem.</p>

<p>For chrome browser (24+) there is for now an experiment sass support feature. Obtain how to use it - <a href="http://benfrain.com/add-sass-compass-debug-info-for-chrome-web-developer-tools">http://benfrain.com/add-sass-compass-debug-info-for-chrome-web-developer-tools/</a></p>

<p>For firefox you have <a href="https://addons.mozilla.org/pl/firefox/addon/firesass-for-firebug">FireSass extension</a>. You will find instructions on how to use it on <a href="http://nex-3.com/posts/92-firesass-bridges-the-gap-between-sass-and-firebug">http://nex-3.com/posts/92-firesass-bridges-the-gap-between-sass-and-firebug</a></p>

<p>This solutions requires adding two config lines to config.rb file</p>
<noscript><pre>
	sass_options = {:debug_info =&gt; true}
	output_style = :expanded
</pre></noscript>
<script src="https://gist.github.com/4457378.js?file=config_v2.rb"> </script>

<h2 id="sass-compiling-improvements">Sass compiling improvements</h2>

<p>At the end some tips how to improve stylesheet generation.</p>

<p>Just type in the console</p>

<p><code>compass watch</code></p>

<p>And now everytime if you change something in your sass files, the compass will notice this and your stylesheets will be recompiled.</p>

<p>You can also execute <code class="inline">compass compile</code> after your project compilation adding this to the end of the project file</p>
<noscript><pre>
<target name="AfterCompile" condition=" '$(Configuration)' == 'Release' ">
    <exec command="compass compile" />
    <itemgroup>
        <content include="Styles\*.css" />
    </itemgroup>
</target>
</pre></noscript>
<script src="https://gist.github.com/4457378.js?file=project.xml"> </script>

<h2 id="full-solution">Full solution</h2>

<p>You can find end solution on <a href="https://github.com/tsubik/aspnet_twitter_sass">github</a>. That’s it, for futher reading I recommend <a href="http://thesassway.com">The Sass Way</a></p>


                </div>
            </article>
        </section>
        <hr class="blog-posts-separator"/>
   

    <!-- Pagination links -->
    <div class="pagination">
      
        <a href="/blog/page2" class="previous">&lt;&lt;Older posts</a>
      
      
      
    </div>   
</div> 
        <footer>
            Copyright (c) 2012 Tomasz Subik
        </footer>
        </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11585946-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
